<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Guesser Page</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
<div class="container">
    <div class="row">
        {% for card in question_cards %}
        <div class="col-3">
            <img src="{{ card.image_url }}" class="img-fluid selectable-img" id="img-{{ loop.index }}" data-difficulty="{{ card.difficulty }}" data-theme="{{ card.theme_id }}">
            <div class="labels">{{ card.username }}, {{ card.difficulty }}</div>
        </div>
        {% endfor %}
    </div>
    <button id="exit-btn" class="btn btn-primary">Exit</button>
    <button id="choose-btn" class="btn btn-primary" disabled>Choose</button>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script>
    $(document).ready(function() {
        // Add click event listener to each image
        $('.selectable-img').click(function() {
            // Remove border from all images
            $('.selectable-img').removeClass('selected-img');
            // Add border to clicked image
            $(this).addClass('selected-img');
            // Enable the "Choose" button
            $('#choose-btn').prop('disabled', false);
        });

        // Add click event listener to the "Choose" button
        $('#choose-btn').click(function() {
            // Get the difficulty level and theme of the selected image
            var difficulty = $('.selected-img').data('difficulty');
            var theme = $('.selected-img').data('theme');

            // Fetch a question based on the difficulty level
            fetch('/get_question_by_difficulty', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ difficulty: difficulty }),
            })
            .then(response => response.json())
            .then(data => {
                // Store the question ID in the session storage
                sessionStorage.setItem('difficulty_question_id', data.question_id);

                // Fetch a question based on the theme
                return fetch('/get_post_by_theme', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ theme: theme }),
                });
            })
            .then(response => response.json())
            .then(data => {
                // Store the question ID in the session storage
                sessionStorage.setItem('theme_question_id', data.question_id);

                // Redirect to the post page
                window.location.href = '/post';
            });
        });

        // Add click event listener to the "Exit" button
        $('#exit-btn').click(function() {
            // Redirect to the main page
            window.location.href = '/';
        });
    });
</script>
</body>
</html>